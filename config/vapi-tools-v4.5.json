{
  "version": "4.5.0",
  "codename": "QUALITY",
  "tools": [
    {
      "type": "function",
      "async": false,
      "function": {
        "name": "log_lead_details",
        "description": "Log the lead after collecting all information and confirming phone number. Call this before closing the conversation.",
        "strict": true,
        "parameters": {
          "type": "object",
          "properties": {
            "caller_name": {
              "type": "string",
              "description": "Full name as the caller provided it",
              "minLength": 2
            },
            "phone_number": {
              "type": "string",
              "description": "UK mobile number in +44 or 07 format",
              "pattern": "^(\\+44|0)7[0-9]{9}$"
            },
            "phone_confirmed": {
              "type": "boolean",
              "description": "TRUE only if you read the number back and they confirmed it",
              "default": false
            },
            "category": {
              "type": "string",
              "enum": ["Renovation", "Maintenance", "Emergency", "Other"]
            },
            "address": {
              "type": "string",
              "description": "Property address - street name and area at minimum"
            },
            "postcode": {
              "type": "string",
              "description": "Postcode district (NW3) or full postcode",
              "pattern": "^[A-Z]{1,2}[0-9R][0-9A-Z]?(\\s?[0-9][A-Z]{2})?$"
            },
            "summary": {
              "type": "string",
              "description": "Natural description of what they need - be specific",
              "maxLength": 200
            },
            "project_type": {
              "type": "string",
              "enum": [
                "Extension", "Loft Conversion", "Basement", "Full Refurbishment",
                "Kitchen", "Bathroom", "Plumbing", "Electrics", "Boiler",
                "Leak", "Structural", "Roofing", "Windows/Doors", "Flooring",
                "Decorating", "External/Garden", "Multi-trade", "Emergency", "Other"
              ]
            },
            "sentiment": {
              "type": "string",
              "enum": ["High Value", "Standard", "Urgent"],
              "description": "High Value = major project or premium postcode, Urgent = emergency or time-sensitive"
            },
            "caller_emotion": {
              "type": "string",
              "enum": ["Excited", "Positive", "Neutral", "Concerned", "Stressed", "Frustrated"],
              "description": "How did the caller seem emotionally?"
            },
            "timeline": {
              "type": "string",
              "enum": ["ASAP", "1-2 weeks", "1 month", "2-3 months", "3-6 months", "6+ months", "Planning stage", "Unknown"]
            },
            "estimated_value": {
              "type": "string",
              "enum": ["Under £5k", "£5k-£15k", "£15k-£30k", "£30k-£50k", "£50k-£100k", "Over £100k", "Unknown"],
              "description": "Estimate based on project scope"
            },
            "returning_client": {
              "type": "boolean",
              "default": false
            },
            "lead_score": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "description": "1-10: 9-10 major project premium area, 7-8 significant work, 5-6 medium, 3-4 small, 1-2 minimal"
            },
            "call_quality": {
              "type": "string",
              "enum": ["Excellent", "Good", "Adequate", "Difficult"],
              "description": "How well did the conversation go?"
            },
            "notes": {
              "type": "string",
              "description": "Important details: architect involved, planning permission status, access issues, callback preferences, anything Ross should know"
            }
          },
          "required": [
            "caller_name", 
            "phone_number", 
            "phone_confirmed",
            "category", 
            "summary", 
            "sentiment", 
            "lead_score"
          ]
        }
      },
      "server": {
        "url": "https://hook.eu1.make.com/YOUR_WEBHOOK_ID_HERE",
        "secret": "YOUR_SECRET_HERE",
        "timeoutSeconds": 6,
        "headers": {
          "X-Lead-Score": "{{lead_score}}",
          "X-Category": "{{category}}",
          "X-Phone-Confirmed": "{{phone_confirmed}}"
        }
      },
      "messages": [
        {"type": "request-start", "content": ""},
        {"type": "request-complete", "content": ""},
        {"type": "request-failed", "content": "I've made a note of all your details."},
        {"type": "request-response-delayed", "content": "", "timingMilliseconds": 2000}
      ]
    },
    {
      "type": "function",
      "async": true,
      "function": {
        "name": "log_spam",
        "description": "Log spam calls for blocking",
        "parameters": {
          "type": "object",
          "properties": {
            "spam_type": {
              "type": "string",
              "enum": ["SEO", "Marketing", "Recruitment", "Lead Generation", "Insurance", "Energy", "Telecoms", "Finance", "IT Services", "Surveys", "Scam", "Other"]
            },
            "company_name": {
              "type": "string",
              "description": "Company name if mentioned"
            },
            "caller_number": {
              "type": "string"
            }
          },
          "required": ["spam_type"]
        }
      },
      "server": {
        "url": "https://hook.eu1.make.com/YOUR_SPAM_WEBHOOK",
        "timeoutSeconds": 2
      },
      "messages": []
    },
    {
      "type": "function",
      "async": true,
      "function": {
        "name": "lookup_client",
        "description": "Check if this is a returning client",
        "parameters": {
          "type": "object",
          "properties": {
            "phone_number": {"type": "string"}
          },
          "required": ["phone_number"]
        }
      },
      "server": {
        "url": "https://hook.eu1.make.com/YOUR_LOOKUP_WEBHOOK",
        "timeoutSeconds": 3
      },
      "messages": []
    },
    {
      "type": "function",
      "async": false,
      "function": {
        "name": "confirm_phone_number",
        "description": "Use this to structure phone number readback",
        "parameters": {
          "type": "object",
          "properties": {
            "phone_number": {
              "type": "string",
              "description": "The phone number to confirm"
            },
            "formatted": {
              "type": "string",
              "description": "Phone formatted for speaking: 'oh seven four five nine, three four five, four five six'"
            }
          },
          "required": ["phone_number", "formatted"]
        }
      },
      "server": {
        "url": "https://hook.eu1.make.com/YOUR_CONFIRM_WEBHOOK",
        "timeoutSeconds": 2
      },
      "messages": [
        {"type": "request-start", "content": "Let me just read that back to you:"},
        {"type": "request-complete", "content": ""}
      ]
    },
    {
      "type": "endCall",
      "function": {
        "name": "end_call",
        "description": "End the call gracefully"
      },
      "messages": [
        {"type": "request-complete", "content": "Thank you so much for calling Hampstead Renovations. Have a lovely day. Goodbye!"}
      ]
    },
    {
      "type": "transferCall",
      "function": {
        "name": "transfer_to_ross",
        "description": "Emergency transfer to Ross - use ONLY for genuine emergencies when caller insists",
        "parameters": {
          "type": "object",
          "properties": {
            "reason": {"type": "string"},
            "severity": {"type": "string", "enum": ["critical", "high"]}
          },
          "required": ["reason"]
        }
      },
      "destinations": [
        {
          "type": "number",
          "number": "+447459345456",
          "message": "I'm just transferring you to Ross now. One moment please.",
          "description": "Ross mobile - genuine emergencies only",
          "transferPlan": {
            "mode": "warm-transfer",
            "timeout": 30
          }
        }
      ]
    }
  ],
  "qualityChecks": {
    "beforeFunctionCall": [
      {"check": "phone_confirmed", "required": true, "message": "Always read back the phone number before logging"},
      {"check": "name_captured", "required": true},
      {"check": "category_determined", "required": true}
    ],
    "phoneConfirmation": {
      "required": true,
      "format": "digit_by_digit_grouped",
      "example": "oh-seven-four-five-nine, three-four-five, four-five-six",
      "waitForConfirmation": true
    }
  },
  "metadata": {
    "version": "4.5.0",
    "focus": "conversation_quality",
    "improvements": [
      "Mandatory phone confirmation with readback",
      "phone_confirmed field required",
      "caller_emotion tracking",
      "call_quality self-assessment",
      "Enhanced notes field",
      "Warm transfer for emergencies",
      "Quality checks before logging"
    ]
  }
}
